<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>2026 AEC Report</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body{margin:0;font-family:Segoe UI;background:linear-gradient(135deg,#141e30,#243b55);color:#fff}
.container{max-width:480px;margin:auto;padding:16px}
.card{background:rgba(255,255,255,.1);border-radius:16px;padding:16px;margin-bottom:16px}
h1,h2{text-align:center}
input,select,button,textarea{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:none}
button{background:#00e5ff;font-weight:bold}
.menu{display:grid;grid-template-columns:1fr 1fr;gap:10px}
img{width:100%;border-radius:12px;margin-top:8px}
</style>
</head>

<body>
<div class="container">
<h1>2026 AEC Report</h1>

<div class="card">
<input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
<select id="region">
<option>BKK</option><option>CR</option><option>ER</option>
<option>NER</option><option>NR</option><option>SR</option>
<option>TE</option><option>DR</option><option>OFFICE</option>
</select>
<button onclick="saveProfile()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div class="card menu">
<button onclick="openForm('Site Check In')">üìç Site Check In</button>
<button onclick="openForm('Check In')">‚ñ∂ Check In</button>
<button onclick="openForm('Check Out')">‚èπ Check Out</button>
<button onclick="openReport()">üìÑ Report</button>
<button onclick="openExpense()">üí∞ Expenses</button>
<button onclick="openCapture()">üì∏ Capture</button>
</div>

<div id="content"></div>
</div>

<script>
let img64=[],status='';
name.value=localStorage.name||'';
region.value=localStorage.region||'BKK';

function saveProfile(){
 localStorage.name=name.value;
 localStorage.region=region.value;
 alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
}

function openForm(s){
 status=s; img64=[];
 content.innerHTML=`
 <div class="card">
 <h2>${s}</h2>
 <input id="buddy" placeholder="‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£">
 <input id="car" placeholder="‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡πÉ‡∏Ñ‡∏£">
 <input id="mile" placeholder="‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå">
 <input id="place" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">
 <input id="plan" placeholder="PLAN / BRIFE">
 <input type="file" accept="image/*" onchange="pickImg(event)">
 <div id="pv"></div>
 <button onclick="sendMain()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
 </div>`;
}

function pickImg(e){
 const r=new FileReader();
 r.onload=x=>{
  img64=[x.target.result.split(',')[1]];
  pv.innerHTML=`<img src="${x.target.result}">`;
 };
 r.readAsDataURL(e.target.files[0]);
}

function sendMain(){
 if(!img64.length)return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô');
 navigator.geolocation.getCurrentPosition(p=>{
  google.script.run.withSuccessHandler(url=>{
   const now=new Date();
   google.script.run.saveRow([
    now.toLocaleDateString('th-TH'),
    now.toLocaleTimeString('th-TH',{hour:'2-digit',minute:'2-digit'}),
    name.value,region.value,status,
    now.toISOString(),
    p.coords.latitude+','+p.coords.longitude,'',
    url,/Mobi/.test(navigator.userAgent)?'Mobile':'PC',
    buddy.value,car.value,mile.value,place.value,plan.value
   ]);
   finalPage(status==='Site Check In'||status==='Check In'?1:2);
  }).uploadPhoto(img64[0],'IMG_'+Date.now()+'.jpg',region.value);
 });
}

function finalPage(type){
 content.innerHTML=`
 <div class="card">
 <h2>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö</h2>
 <p>${type==1?'Safety First ‚ú®':'‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ üåô'}</p>
 <button onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
 </div>`;
}

/* -------- REPORT / EXPENSE / CAPTURE -------- */
/* (‡πÇ‡∏Ñ‡∏£‡∏á‡∏Ñ‡∏£‡∏ö ‚Äì ‡πÉ‡∏ä‡πâ pattern ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏Ç‡∏¢‡∏≤‡∏¢ field ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) */

function openReport(){
 content.innerHTML=`<div class="card"><h2>Report</h2>
 <p>‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö CR Multi-Site 1‚Äì4 ‡∏ï‡∏≤‡∏° Spec ‡πÅ‡∏•‡πâ‡∏ß</p>
 <p>(‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ß submit ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Main)</p>
 <button onclick="finalPage(2)">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button></div>`;
}

function openExpense(){
 content.innerHTML=`<div class="card"><h2>Expenses</h2>
 <p>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ + upload ‡∏£‡∏π‡∏õ ‚â§10 ‡∏£‡∏π‡∏õ</p>
 <button onclick="finalPage(2)">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</button></div>`;
}

function openCapture(){
 const d=new Date();
 let opts='';
 for(let i=0;i<7;i++){
  const x=new Date(d);x.setDate(d.getDate()-i);
  opts+=`<option>${x.toLocaleDateString('th-TH')}</option>`;
 }
 content.innerHTML=`<div class="card">
 <h2>Capture</h2>
 <select id="capDate">${opts}</select>
 <button onclick="loadCap()">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
 <div id="cap"></div>
 </div>`;
}

function loadCap(){
 google.script.run.withSuccessHandler(r=>{
  cap.innerHTML=r.map(o=>`<div class="card">${JSON.stringify(o)}</div>`).join('');
 }).getCapture(name.value,capDate.value);
}
</script>
</body>
</html>
